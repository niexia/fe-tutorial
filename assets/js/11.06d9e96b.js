(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{358:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAr0AAAE7CAYAAADQJTmAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABF4SURBVHhe7d0xj1zlFcfhfCYqGgoiJBcWASFFEYJsJMsmFUpPl8ZKTWrSWmkipJR8BbdIqeAjuKSccEzOzPXh3fVaOuGId55H+mtnZ+7c9U5c/HR1TX5zAgCAzYleAAC2J3oBANie6AUAYHuiFwCA7YleAAC2J3oBANie6AUAYHuiFwCA7YleAAC2J3oBANie6AUAYHuiFwCA7YleAAC2J3oBANie6AUAYHuiFwCA7YleAAC2J3oBANie6AUAYHuiF2j35MmT01tvvWU2uvh7CJBEL9BuFSBmEwNIohdodw6Ozz4zG5noBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqDdtUTv1x999HLx+MWjR6fP33339N3Nzen5xx+fn8/Xbt555/y5xL54773T0wcPXnkuF+/P9x6X57nt9dgPjx+/PHce8+XDh8ufEYvX6vt3Wf6OAEn0Au3OwbGIkV0WcRnRGpFbv49FeB7DN4+J0Ix4PT5/3LMPPrjz9Tjn62K1hu9q8ZroBa6J6AXaXUP01misoXm88pvHxOMI4zg2j4lzrL7P8+Vn+brlnyW+3hW7OdELXBvRC7Q7B8ciRnZYBmm9khsRGcvfPxa3I+SV23jt+J6I4K/ef//8/TFE42ccryTfteP74mtGb/2zxPI40QtcG9ELtDsHxyJGdlgEY/x+eatB/r6xiOG8cntcxOsffwzgY8TGeY4RHI8zWOvi+QzoWDxeRWs8l+c4Po7F43zP8fGOy/89AJLoBdqdg2MRI7/2RXDGbQtxFbZe6c0IPj4XW92qENEZOz6XO14dzmNW5129Fo/j+Xx8PO/x2Dhmdc5dlr8vQBK9QLtzcCxi5Ne+iMVYBG6N3nh+daU3ru5GJEdkxmt3XdHNY//z6aenh2+/fa8wjXNlKMfxee7j4zwuz3d8vONEL1CJXqDdztGbW0VvRGdEb16lra9FZN43ejOc49j8PG/b8c8hen9afjYASfQC7c7BsYiRXbaK3ryNYRWhNXqfffjhyyu5+Vnl4vlj9Natfu5xx9CNx/X8GbqiF7g2ohdodw6ORYzsstviM2IybzWIcI2Ajau3973SG8/f9o/hYm8avXf9HNELXBPRC7S75uiNRUxGuH77yScv/9FbBG8sYjg/m9tiNM55V4y+SfTeNdELXBvRC7Q7B8ciRnbZXfEZV2kjeuMzyGPuutIbV4LzVof4Gt8fz3Gf5dXhu6L3+HNi94njX+vydwRIohdodw6ORYyY/RITvUAleoF2otemJ3qBSvQC7USvTU/0ApXoBdqJXpue6AUq0Qu0E702PdELVKIXaCd6bXqiF6hEL9BO9Nr0RC9QiV6gnei16YleoBK9QDvRa9MTvUAleoF2otemJ3qBSvQC7USvTU/0ApXoBdqJXpue6AUq0Qu0E702PdELVKIXaCd6bXqiF6hEL9BO9Nr0RC9QiV6gnei16YleoBK9QDvRa9MTvUAleoF2otemJ3qBSvQC7USvTU/0ApXoBdplcJhNDyCJXqDdKj7MJgaQRC/Q7hIcn5mNTPQClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7S75uj94YfHp6dPH5y+++7m/NyLF49OX3zx3un7729ONzfvnJ4///iV99R9/fVHL4+Pc61ej8U58pj4WQ8fvn3+3I+L549/lmtZ/v4ASfQC7S7BsQ6SnXdX9MbX2Oefv3tniN7nmNgxfFevr/4s1zLRC1SiF2h3rdH75ZcPz797LIM04/Obb37/yhXZiNbY8T13La/axuJ8t8VuTvSKXuBC9ALtLsGxDpKdd7xKG9EZ4Zufx+qqbERvxPLxudWOAXuM3nhcb23IOD6+Z3XOnZefBUASvUC7S3Csg2Tn5ZXbuHc3Ajieu298xnERxnFPb3wfX1f35Mb3x+jNx3mO/Fn3/bk7TvQClegF2l1r9EZkfvXV+y/D9dmzD8/xGourufHc8apsvh7vi/esAnf12jF04/HxnLE8Nl4XvQA/Eb1Au0twrINk10XERthGaH777Sfnx/l5HK/+5iKGV7Fbl/EbP6NGbz7O4zJ0Ra/oBS5EL9DuEhzrINl18Q/VImpXoRmxmvfu1v/qQrwngjg/t9WOwSx6X7/83ACS6AXaXYJjHSQ777bQjO/zNoTVFd/j4rWI4tuOOYbu8bw5tzeIXuDnRC/Q7hIc6yDZeavQPIZp3scbz2W45nG5N43e284jekUvcCF6gXai96fQzP9ub97KEM9F/MbtDRG/GcB1bxK9q9dzolf0AheiF2gnem8PzQzfvAXhTf7PKWJx/OuiN2M7drx3+JqWvz9AEr1Au0twrIPE7P890QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0C6Dw2x6AEn0Au1W8WE2MYAkeoF25+D492dmIxO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0E702vREL1CJXqCd6LXpiV6gEr1AO9Fr0xO9QCV6gXai16YneoFK9ALtRK9NT/QClegF2olem57oBSrRC7QTvTY90QtUohdoJ3pteqIXqEQv0O6ao/fFPx+dvvjTey+/5nNf//Wjl3v+949PX/7l4SvHrxbHxjl++Nfj5euxOFce890/bk4Pf/v2+XM/Lp6P11fn2Hn5+wMk0Qu0OwfHIkZ2X43e+n1Eb0Tt8T11ceznf3j3tbF6DN/V6/H80z8/EL0APxK9QDvR+2rk5udRF69FuK5eWy2v2sYiZu+6EhwTvaIXuBC9QLtzcCxiZOfdFrh5S0NEaDzOII7d95aHY8Aeozce11sbMo5Fr+gFLkQv0O4cHIsY2X3HK70Rs7eFcCyC9/jeiNR4b97+EF9X9+TW6M3HeY4MXdEreoEL0Qu0OwfHIkZ2X7294XglNyK0XunN5+M9q8BdvXYM3XjsSu/Pd/47CPA/ohdodw6ORYzsvjeN3vh+Fbt1Gb9x9bdGbz7O4zJ0j4/r+Xaf6AUq0Qu0E72vRm9+HnV5e0Mce/O7d5bH5OL1PKfoff3ycwNIohdodw6ORYzsvmPAxtdv/vb7197eUBevH8O5rkav2xt+vvwsAJLoBdqdg2MRIzsvgjZ+74zc2H3u6a170+jNx/U40St6gQvRC7S71uhd7a7bGyJsV7H6JtG7ej0nekUvcCF6gXbn4FjEyLXteKV3tbuieLU4/nXRm1ecY7eF9e7L3x8giV6g3Tk4FjFi9ktM9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUA70WvTE71AJXqBdqLXpid6gUr0Au1Er01P9AKV6AXaiV6bnugFKtELtBO9Nj3RC1SiF2gnem16oheoRC/QTvTa9EQvUIleoJ3otemJXqASvUC7DA6z6QEk0Qu0e/LkyTJAzH7Jxd9DgCR6AQDYnugFAGB7ohcAgO2JXgAAtid6AQDYnugFAGB7ohcAgO2JXgAAtid6AQDYnugFAGB7ohcAgO2JXgAAtid6AQDYnugFAGB7ohcAgO2JXgAAtid6AQDYnugFAGB7ohcAgO2JXgAANnc6/RfbOGowAsjBlAAAAABJRU5ErkJggg=="},359:function(t,e,a){t.exports=a.p+"assets/img/javascript-browser-store-eg2.4f770e31.png"},360:function(t,e,a){t.exports=a.p+"assets/img/javascript-browser-store-eg3.77ee7550.png"},361:function(t,e,a){t.exports=a.p+"assets/img/javascript-browser-store-eg4.2bcf661d.png"},362:function(t,e,a){t.exports=a.p+"assets/img/javascript-browser-store-eg5.cbdac7e0.png"},363:function(t,e,a){t.exports=a.p+"assets/img/javascript-browser-store-eg6.b987d169.png"},478:function(t,e,a){"use strict";a.r(e);var v=a(38),o=Object(v.a)({},function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"栈空间和堆空间"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#栈空间和堆空间","aria-hidden":"true"}},[t._v("#")]),t._v(" 栈空间和堆空间")]),t._v(" "),v("p",[t._v("接下来 JavaScript 的内存机制，包括数据在内存中的存放、JavaScript 处理垃圾回收。")]),t._v(" "),v("h2",{attrs:{id:"基本类型和引用类型"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#基本类型和引用类型","aria-hidden":"true"}},[t._v("#")]),t._v(" 基本类型和引用类型")]),t._v(" "),v("p",[t._v("ECMAScript 变量可能包含两种不同数据类型的值：基本类型值和引用类型值。")]),t._v(" "),v("p",[t._v("基本类型有 6 种：")]),t._v(" "),v("ul",[v("li",[v("code",[t._v("Number")])]),t._v(" "),v("li",[v("code",[t._v("String")])]),t._v(" "),v("li",[v("code",[t._v("Null")])]),t._v(" "),v("li",[v("code",[t._v("Undefined")])]),t._v(" "),v("li",[v("code",[t._v("Boolean")])]),t._v(" "),v("li",[v("code",[t._v("Symbol")])])]),t._v(" "),v("p",[t._v("引用数据类型则有 Object、Array 等。")]),t._v(" "),v("p",[t._v("之所以把它们区分为两种不同的类型，是因为它们在内存中存放的位置不一样。到底怎么个不一样法呢？接下来看一下它们是怎么存储的。")]),t._v(" "),v("h2",{attrs:{id:"内存空间"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#内存空间","aria-hidden":"true"}},[t._v("#")]),t._v(" 内存空间")]),t._v(" "),v("p",[t._v("JavaScript 在运行过程中数据是如何存储的，你就得先搞清楚其存储空间的种类：")]),t._v(" "),v("p",[v("img",{attrs:{src:a(358),alt:"eg1"}})]),t._v(" "),v("p",[t._v("可以看出来，在 JavaScript 的执行过程中，"),v("strong",[t._v("主要有三种类型内存空间，分别是代码空间、栈空间和堆空间")]),t._v("。其中的代码空间主要是存储可执行代码的。")]),t._v(" "),v("h2",{attrs:{id:"栈空间和堆空间-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#栈空间和堆空间-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 栈空间和堆空间")]),t._v(" "),v("h3",{attrs:{id:"基本类型保存在栈中，引用类型保存在堆中"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#基本类型保存在栈中，引用类型保存在堆中","aria-hidden":"true"}},[t._v("#")]),t._v(" 基本类型保存在栈中，引用类型保存在堆中")]),t._v(" "),v("p",[t._v("栈空间就是调用栈，是用来存储执行环境的。为了搞清楚栈空间是如何存储数据的，我们还是先看下面这段代码：")]),t._v(" "),v("div",{staticClass:"language-js extra-class"},[v("pre",{pre:!0,attrs:{class:"language-js"}},[v("code",[v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" a"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" c "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" d "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" d"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),v("p",[t._v("调用 "),v("code",[t._v("foo()")]),t._v(" 是会创建一个函数执行环境，当执行到第 3 行代码时，其调用栈的状态，你可以参考下面这张调用栈状态图：")]),t._v(" "),v("p",[v("img",{attrs:{src:a(359),alt:"eg2"}})]),t._v(" "),v("p",[t._v("变量 "),v("code",[t._v("a")]),t._v(" 和变量 "),v("code",[t._v("b")]),t._v(" 的值都被保存在执行环境中，而执行环境又被压入到栈中，所以你也可以认为变量 "),v("code",[t._v("a")]),t._v(" 和变量 "),v("code",[t._v("b")]),t._v(" 的值都是存放在栈中的。")]),t._v(" "),v("p",[t._v("接下来，到第 4 行代码的时候就不一样了。JavaScript 引擎判断右边的值是一个引用类型。这时和前面的处理方式就不一样了。")]),t._v(" "),v("p",[v("strong",[t._v("JavaScript 引擎并不是直接将该对象存放到变量环境中，而是将它分配到堆空间里面，分配后该对象会有一个在“堆”中的地址，然后再将该数据的地址写进 "),v("code",[t._v("c")]),t._v(" 的变量值")]),t._v("，最终分配好内存的示意图如下所示：")]),t._v(" "),v("p",[v("img",{attrs:{src:a(360),alt:"eg3"}})]),t._v(" "),v("p",[t._v("可以看到，对象类型是存放在堆空间的，在栈空间中只是保留了对象的引用地址，当 JavaScript 需要访问该数据的时候，是通过栈中的引用地址来访问的。")]),t._v(" "),v("p",[v("strong",[t._v("所以，基本类型保存在栈中，而引用类型保存在堆中。基本类型的赋值是复制变量值，而引用类型赋值是复制引用地址。")])]),t._v(" "),v("h3",{attrs:{id:"为什么一定要分“堆”和“栈”两个存储空间呢？"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#为什么一定要分“堆”和“栈”两个存储空间呢？","aria-hidden":"true"}},[t._v("#")]),t._v(" 为什么一定要分“堆”和“栈”两个存储空间呢？")]),t._v(" "),v("p",[t._v("为什么一定要分“堆”和“栈”两个存储空间呢？所有数据直接存放在“栈”中不就可以了吗？")]),t._v(" "),v("p",[v("strong",[t._v("这是不可以的，这是因为 JavaScript 引擎需要用栈来维护程序执行期间上下文的状态，如果栈空间大了话，所有的数据都存放在栈空间里面，那么会影响到上下文切换的效率那么会影响到上下文切换的效率，进而又影响到整个程序的执行效率。")])]),t._v(" "),v("p",[t._v("比如文中的 "),v("code",[t._v("foo")]),t._v(" 函数执行结束了，JavaScript 引擎需要离开当前的执行环境，只需要将指针下移到上个执行环境的地址就可以了，"),v("code",[t._v("foo")]),t._v(" 函数执行环境栈区空间全部回收。")]),t._v(" "),v("p",[v("img",{attrs:{src:a(361),alt:"eg4"}})]),t._v(" "),v("p",[t._v("所以通常情况下，栈空间都不会设置太大，主要用来存放一些基本类型的小数据。而引用类型的数据占用的空间都比较大，所以这一类数据会被存放到堆中，堆空间很大，能存放很多大的数据，不过缺点是分配内存和回收内存都会占用一定的时间。")]),t._v(" "),v("p",[t._v("最后执行 "),v("code",[t._v("d = c")]),t._v(" 就是把 "),v("code",[t._v("c")]),t._v(" 的引用地址赋值给 "),v("code",[t._v("d")]),t._v("，这样变量 c 和 变量 d 都指向同一个堆中的对象。")]),t._v(" "),v("p",[v("img",{attrs:{src:a(362),alt:"eg5"}})]),t._v(" "),v("p",[t._v("所以进行赋值的时候需要考虑是否需要"),v("router-link",{attrs:{to:"/javaScript/深拷贝和浅拷贝.html"}},[t._v("深拷贝和浅拷贝")]),t._v("。")],1),t._v(" "),v("h2",{attrs:{id:"再谈闭包的存储"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#再谈闭包的存储","aria-hidden":"true"}},[t._v("#")]),t._v(" 再谈闭包的存储")]),t._v(" "),v("p",[t._v("先看段代码：")]),t._v(" "),v("div",{staticClass:"language-js extra-class"},[v("pre",{pre:!0,attrs:{class:"language-js"}},[v("code",[t._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" myName "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" test1 "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" test2 "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" innerBar "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n      "),v("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("setName")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("newName")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        myName "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" newName\n      "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),v("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getName")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("test1"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" myName\n      "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" innerBar\n"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),v("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bar "),v("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nbar"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token string"}},[t._v('"baz"')]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nbar"),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),v("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),v("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),v("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "baz"')]),t._v("\n")])])]),v("p",[t._v("通过前面的分析，我们知道 "),v("code",[t._v("myName")]),t._v("、"),v("code",[t._v("test1")]),t._v("、"),v("code",[t._v("test2")]),t._v(" 都是基本类型，在 "),v("code",[t._v("foo")]),t._v(" 执行的时候，它们将会压入栈中；当 "),v("code",[t._v("foo")]),t._v(" 执行结束之后，"),v("code",[t._v("foo")]),t._v(" 函数的执行环境将会被销毁，其内部的变量 "),v("code",[t._v("myName")]),t._v("、"),v("code",[t._v("test1")]),t._v("、"),v("code",[t._v("test2")]),t._v(" 也"),v("strong",[t._v("应该一同被销毁")]),t._v("。")]),t._v(" "),v("p",[t._v("但是，"),v("code",[t._v("foo()")]),t._v(" 产生了闭包，所以当 "),v("code",[t._v("foo")]),t._v(" 函数的执行环境将会被销毁是，变量 "),v("code",[t._v("myName")]),t._v("、"),v("code",[t._v("test1")]),t._v(" 并没有一起被销毁，而是保存在内存中。应该怎么解释呢？")]),t._v(" "),v("p",[t._v("分析一下这段代码的执行过程：")]),t._v(" "),v("ol",[v("li",[t._v("当 JavaScript 引擎执行到 "),v("code",[t._v("foo")]),t._v(" 函数时，首先会编译，并创建一个空执行环境。")]),t._v(" "),v("li",[t._v("在编译过程中，遇到内部函数 "),v("code",[t._v("setName")]),t._v("，JavaScript 引擎还要对内部函数做一次快速的词法扫描，发现该内部函数引用了 "),v("code",[t._v("foo")]),t._v(" 函数中的 "),v("code",[t._v("myName")]),t._v(" 变量，"),v("strong",[t._v("由于是内部函数引用了外部函数的变量，所以 JavaScript 引擎判断这是一个闭包，于是在堆空间创建换一个“"),v("code",[t._v("closure(foo)")]),t._v("”的对象（这是一个内部对象，JavaScript 是无法访问的），用来保存 "),v("code",[t._v("myName")]),t._v(" 变量")]),t._v("。")]),t._v(" "),v("li",[t._v("接着继续扫描到 "),v("code",[t._v("getName")]),t._v(" 方法时，发现该函数内部还引用变量 "),v("code",[t._v("test1")]),t._v("，于是 JavaScript 引擎又将 "),v("code",[t._v("test1")]),t._v(" 添加到“"),v("code",[t._v("closure(foo)")]),t._v("”对象中。这时候堆中的“"),v("code",[t._v("closure(foo)")]),t._v("”对象中就包含了 "),v("code",[t._v("myName")]),t._v(" 和 "),v("code",[t._v("test1")]),t._v(" 两个变量了。")]),t._v(" "),v("li",[t._v("由于 "),v("code",[t._v("test2")]),t._v(" 并没有被内部函数引用，所以 "),v("code",[t._v("test2")]),t._v(" 依然保存在调用栈中。")])]),t._v(" "),v("p",[v("img",{attrs:{src:a(363),alt:"eg5"}})]),t._v(" "),v("p",[t._v("从上图可以看出，当执行到 "),v("code",[t._v("foo")]),t._v(" 函数时，就产生了闭包；当 "),v("code",[t._v("foo")]),t._v(" 函数执行结束之后，返回的 "),v("code",[t._v("getName")]),t._v(" 和 "),v("code",[t._v("setName")]),t._v(" 方法都引用“"),v("code",[t._v("clourse(foo)")]),t._v("”对象。即使 "),v("code",[t._v("foo")]),t._v(" 函数退出了，“"),v("code",[t._v("clourse(foo)")]),t._v("”依然被其内部的 "),v("code",[t._v("getName")]),t._v(" 和 "),v("code",[t._v("setName")]),t._v(" 方法引用。所以在下次调用 "),v("code",[t._v("bar.setName")]),t._v(" 或者 "),v("code",[t._v("bar.getName")]),t._v(" 时，创建的执行环境中就包含了“"),v("code",[t._v("clourse(foo)")]),t._v("”。")]),t._v(" "),v("h2",{attrs:{id:"参考"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://time.geekbang.org/column/article/129596",target:"_blank",rel:"noopener noreferrer"}},[t._v("栈空间和堆空间：数据是如何存储的？"),v("OutboundLink")],1)])])])},[],!1,null,null,null);e.default=o.exports}}]);