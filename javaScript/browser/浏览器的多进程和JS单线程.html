<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器的多进程和JS单线程 | fe-tutorial</title>
    <meta name="description" content="前端学习笔记">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/fe-tutorial/favicon.ico">
  <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-163994034-1"></script>
  <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'UA-163994034-1');
      </script>
    
    <link rel="preload" href="/fe-tutorial/assets/css/0.styles.cbc7dab0.css" as="style"><link rel="preload" href="/fe-tutorial/assets/js/app.c67e16a5.js" as="script"><link rel="preload" href="/fe-tutorial/assets/js/2.16b1dcc2.js" as="script"><link rel="preload" href="/fe-tutorial/assets/js/19.8bd17825.js" as="script"><link rel="prefetch" href="/fe-tutorial/assets/js/10.28bac185.js"><link rel="prefetch" href="/fe-tutorial/assets/js/11.1e1c0df4.js"><link rel="prefetch" href="/fe-tutorial/assets/js/12.20001f33.js"><link rel="prefetch" href="/fe-tutorial/assets/js/13.fd3b0296.js"><link rel="prefetch" href="/fe-tutorial/assets/js/14.39e61b8a.js"><link rel="prefetch" href="/fe-tutorial/assets/js/15.5174a1f6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/16.457c6abe.js"><link rel="prefetch" href="/fe-tutorial/assets/js/17.3940c003.js"><link rel="prefetch" href="/fe-tutorial/assets/js/18.7c79b87e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/20.ad7c323a.js"><link rel="prefetch" href="/fe-tutorial/assets/js/21.90eff1bc.js"><link rel="prefetch" href="/fe-tutorial/assets/js/22.c6f37039.js"><link rel="prefetch" href="/fe-tutorial/assets/js/23.a1ad3ef5.js"><link rel="prefetch" href="/fe-tutorial/assets/js/24.bb7136e6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/25.1050e0be.js"><link rel="prefetch" href="/fe-tutorial/assets/js/26.c23747f5.js"><link rel="prefetch" href="/fe-tutorial/assets/js/27.3e9abcdb.js"><link rel="prefetch" href="/fe-tutorial/assets/js/28.2d1ac800.js"><link rel="prefetch" href="/fe-tutorial/assets/js/29.3ad09fe2.js"><link rel="prefetch" href="/fe-tutorial/assets/js/3.1922b998.js"><link rel="prefetch" href="/fe-tutorial/assets/js/30.c6081425.js"><link rel="prefetch" href="/fe-tutorial/assets/js/31.9807a5ae.js"><link rel="prefetch" href="/fe-tutorial/assets/js/32.09f134ec.js"><link rel="prefetch" href="/fe-tutorial/assets/js/33.5d0a6f6f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/34.747dd02c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/35.5e5cf192.js"><link rel="prefetch" href="/fe-tutorial/assets/js/36.f0037692.js"><link rel="prefetch" href="/fe-tutorial/assets/js/37.cc0a94ec.js"><link rel="prefetch" href="/fe-tutorial/assets/js/38.20f8eed9.js"><link rel="prefetch" href="/fe-tutorial/assets/js/39.90f3797f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/4.2f5865f5.js"><link rel="prefetch" href="/fe-tutorial/assets/js/40.af7314a4.js"><link rel="prefetch" href="/fe-tutorial/assets/js/41.35cf16df.js"><link rel="prefetch" href="/fe-tutorial/assets/js/42.c9641b78.js"><link rel="prefetch" href="/fe-tutorial/assets/js/43.e36effd3.js"><link rel="prefetch" href="/fe-tutorial/assets/js/44.4fd14390.js"><link rel="prefetch" href="/fe-tutorial/assets/js/45.573de03d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/46.480dfa83.js"><link rel="prefetch" href="/fe-tutorial/assets/js/47.43f26ad2.js"><link rel="prefetch" href="/fe-tutorial/assets/js/48.17533853.js"><link rel="prefetch" href="/fe-tutorial/assets/js/49.9626386e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/5.7116cd28.js"><link rel="prefetch" href="/fe-tutorial/assets/js/50.ca1c77cf.js"><link rel="prefetch" href="/fe-tutorial/assets/js/51.78e28db3.js"><link rel="prefetch" href="/fe-tutorial/assets/js/52.1dc3a702.js"><link rel="prefetch" href="/fe-tutorial/assets/js/53.0019597b.js"><link rel="prefetch" href="/fe-tutorial/assets/js/54.662e6eec.js"><link rel="prefetch" href="/fe-tutorial/assets/js/55.0dbe2917.js"><link rel="prefetch" href="/fe-tutorial/assets/js/56.324663f2.js"><link rel="prefetch" href="/fe-tutorial/assets/js/57.4cd3ba6d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/58.08634db8.js"><link rel="prefetch" href="/fe-tutorial/assets/js/59.0bd63f76.js"><link rel="prefetch" href="/fe-tutorial/assets/js/6.e033b4ef.js"><link rel="prefetch" href="/fe-tutorial/assets/js/60.2dee6b1f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/61.32442cb1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/62.f68f7fb7.js"><link rel="prefetch" href="/fe-tutorial/assets/js/63.6df1d006.js"><link rel="prefetch" href="/fe-tutorial/assets/js/64.a0cc5d1a.js"><link rel="prefetch" href="/fe-tutorial/assets/js/65.04b0799d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/66.19d47570.js"><link rel="prefetch" href="/fe-tutorial/assets/js/67.3926c4ae.js"><link rel="prefetch" href="/fe-tutorial/assets/js/68.35b49e91.js"><link rel="prefetch" href="/fe-tutorial/assets/js/69.6c259614.js"><link rel="prefetch" href="/fe-tutorial/assets/js/7.dd4a338c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/70.fa7dbe04.js"><link rel="prefetch" href="/fe-tutorial/assets/js/71.43adb68c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/72.daa1c87e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/73.f4020d8c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/74.14e590f8.js"><link rel="prefetch" href="/fe-tutorial/assets/js/75.b99e90d1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/76.3cc19da7.js"><link rel="prefetch" href="/fe-tutorial/assets/js/77.3591aa10.js"><link rel="prefetch" href="/fe-tutorial/assets/js/78.a0a02177.js"><link rel="prefetch" href="/fe-tutorial/assets/js/79.1d272f02.js"><link rel="prefetch" href="/fe-tutorial/assets/js/8.93f67fc6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/80.96f4df9d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/81.34c02b35.js"><link rel="prefetch" href="/fe-tutorial/assets/js/82.47ef3169.js"><link rel="prefetch" href="/fe-tutorial/assets/js/83.134baf38.js"><link rel="prefetch" href="/fe-tutorial/assets/js/84.0344390f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/85.aa20e28d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/86.dd9be34f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/87.0dff61b3.js"><link rel="prefetch" href="/fe-tutorial/assets/js/88.ff87edf2.js"><link rel="prefetch" href="/fe-tutorial/assets/js/89.8e7a798c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/9.f4d31957.js"><link rel="prefetch" href="/fe-tutorial/assets/js/90.1c0369c7.js"><link rel="prefetch" href="/fe-tutorial/assets/js/91.cb532216.js"><link rel="prefetch" href="/fe-tutorial/assets/js/92.f7f05b93.js"><link rel="prefetch" href="/fe-tutorial/assets/js/93.b5026686.js"><link rel="prefetch" href="/fe-tutorial/assets/js/94.2de0df47.js"><link rel="prefetch" href="/fe-tutorial/assets/js/95.a22e8fed.js"><link rel="prefetch" href="/fe-tutorial/assets/js/96.d9450d6e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/97.dd9b9637.js"><link rel="prefetch" href="/fe-tutorial/assets/js/98.352197bd.js">
    <link rel="stylesheet" href="/fe-tutorial/assets/css/0.styles.cbc7dab0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-tutorial/" class="home-link router-link-active"><!----> <span class="site-name">fe-tutorial</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-tutorial/javaScript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/fe-tutorial/algo/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/fe-tutorial/network/" class="nav-link">
  网络协议
</a></div><div class="nav-item"><a href="/fe-tutorial/fee/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="https://niexias.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/niexias/fe-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-tutorial/javaScript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/fe-tutorial/algo/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/fe-tutorial/network/" class="nav-link">
  网络协议
</a></div><div class="nav-item"><a href="/fe-tutorial/fee/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="https://niexias.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/niexias/fe-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/" class="sidebar-link">介绍</a></li><li><a href="/fe-tutorial/javaScript/执行环境和执行栈.html" class="sidebar-link">执行环境和执行栈</a></li><li><a href="/fe-tutorial/javaScript/作用域和闭包.html" class="sidebar-link">作用域和闭包</a></li><li><a href="/fe-tutorial/javaScript/this.html" class="sidebar-link">this</a></li><li><a href="/fe-tutorial/javaScript/对象、原型和原型链.html" class="sidebar-link">对象、原型和原型链</a></li><li><a href="/fe-tutorial/javaScript/实现继承.html" class="sidebar-link">实现继承</a></li><li><a href="/fe-tutorial/javaScript/实现new.html" class="sidebar-link">实现 new</a></li><li><a href="/fe-tutorial/javaScript/实现call,apply和bind.html" class="sidebar-link">call、apply 和 bind</a></li><li><a href="/fe-tutorial/javaScript/实现instanceof.html" class="sidebar-link">实现 instanceof</a></li><li><a href="/fe-tutorial/javaScript/深拷贝和浅拷贝.html" class="sidebar-link">深拷贝和浅拷贝</a></li><li><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html" class="sidebar-link">节流函数和防抖函数</a></li><li><a href="/fe-tutorial/javaScript/高阶函数.html" class="sidebar-link">高阶函数</a></li><li><a href="/fe-tutorial/javaScript/函数柯里化.html" class="sidebar-link">函数柯里化</a></li><li><a href="/fe-tutorial/javaScript/EventEmitter.html" class="sidebar-link">EventEmitter</a></li><li><a href="/fe-tutorial/javaScript/实现Promise.html" class="sidebar-link">/javaScript/实现Promise.html</a></li><li><a href="/fe-tutorial/javaScript/实现异步打印.html" class="sidebar-link">实现异步打印</a></li><li><a href="/fe-tutorial/javaScript/数组去重,扁平化和最值.html" class="sidebar-link">数组去重，扁平化和最值</a></li><li><a href="/fe-tutorial/javaScript/数组乱序.html" class="sidebar-link">数组乱序</a></li><li><a href="/fe-tutorial/javaScript/懒加载.html" class="sidebar-link">懒加载</a></li><li><a href="/fe-tutorial/javaScript/无限滚动.html" class="sidebar-link">无限滚动</a></li><li><a href="/fe-tutorial/javaScript/虚拟滚动.html" class="sidebar-link">/javaScript/虚拟滚动.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>RegExp</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/RegExp/正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/fe-tutorial/javaScript/RegExp/RegExp的属性和方法.html" class="sidebar-link">RegExp 的属性和方法</a></li><li><a href="/fe-tutorial/javaScript/RegExp/应用.html" class="sidebar-link">应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>浏览器工作原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html" class="active sidebar-link">浏览器的多进程和JS单线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#区分进程和线程" class="sidebar-link">区分进程和线程</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#浏览器是多线程的" class="sidebar-link">浏览器是多线程的</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#浏览器都包含哪些进程？" class="sidebar-link">浏览器都包含哪些进程？</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#浏览器多进程的优势" class="sidebar-link">浏览器多进程的优势</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#重要的浏览器内核（渲染进程）" class="sidebar-link">重要的浏览器内核（渲染进程）</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#浏览器进程和渲染进程的合作" class="sidebar-link">浏览器进程和渲染进程的合作</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#浏览器内核中线程之间的关系" class="sidebar-link">浏览器内核中线程之间的关系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#gui-渲染线程与-js-引擎线程互斥" class="sidebar-link">GUI 渲染线程与 JS 引擎线程互斥</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#webworker，js的多线程？" class="sidebar-link">WebWorker，JS的多线程？</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/fe-tutorial/javaScript/browser/浏览器渲染过程.html" class="sidebar-link">浏览器的渲染过程</a></li><li><a href="/fe-tutorial/javaScript/browser/EventLoop.html" class="sidebar-link">Event Loop</a></li><li><a href="/fe-tutorial/javaScript/browser/栈空间和堆空间.html" class="sidebar-link">栈空间和堆空间</a></li><li><a href="/fe-tutorial/javaScript/browser/垃圾回收.html" class="sidebar-link">垃圾回收</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/effective/性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/fe-tutorial/javaScript/effective/DNS缓存和预解析.html" class="sidebar-link">DNS 缓存和预解析</a></li><li><a href="/fe-tutorial/javaScript/effective/减少请求次数和体积.html" class="sidebar-link">减少请求次数和体积</a></li><li><a href="/fe-tutorial/javaScript/effective/利用缓存.html" class="sidebar-link">利用缓存</a></li><li><a href="/fe-tutorial/javaScript/effective/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/fe-tutorial/javaScript/effective/浏览器渲染机制和优化.html" class="sidebar-link">浏览器渲染机制和优化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器的多进程和js单线程"><a href="#浏览器的多进程和js单线程" class="header-anchor">#</a> 浏览器的多进程和JS单线程</h1> <p>查看了一些文章之后，整理了一下笔记，对浏览器多进程、JS单进程有个整体的理解。</p> <h2 id="区分进程和线程"><a href="#区分进程和线程" class="header-anchor">#</a> 区分进程和线程</h2> <p>线程和进程区分不清，看一个形象的比喻：</p> <ol><li>进程是一个工厂，工厂有它的独立资源；</li> <li>工厂之间相互独立；</li> <li>线程是工厂中的工人，多个工人协作完成任务；</li> <li>工厂内有一个或多个工人；</li> <li>工人之间共享空间。</li></ol> <p>再完善一下观念就是：</p> <ol><li>工厂的资源 -&gt; 系统分配的内存（独立的一块内存）；</li> <li>工厂之间的相互独立 -&gt; 进程之间相互独立；</li> <li>多个工人协作完成任务 -&gt; 多个线程在进程中协作完成任务；</li> <li>工厂内有一个或多个工人 -&gt; 一个进程由一个或多个线程组成；</li> <li>工人之间共享空间 -&gt; 同一进程下的各个线程之间共享程序的内存空间（包括代码段、数据集、堆等）。</li></ol> <p>如果是windows电脑中，可以打开任务管理器，可以看到有一个后台进程列表。对，那里就是查看进程的地方，而且可以看到每个进程的内存资源信息以及cpu占有率：</p> <p><img src="/fe-tutorial/assets/img/javascript-browser-eg1.efd12a6e.png" alt="eg1"></p> <p>最后，再用较为官方的术语描述一遍：</p> <ul><li>进程是cpu资源分配的最小单位（是能拥有资源和独立运行的最小单位）。</li> <li>线程是cpu调度的最小单位（线程是建立在进程的基础上的一次程序运行单位，一个进程中可以有多个线程）。</li></ul> <p>另外还需要说明的是：</p> <ul><li>不同进程之间也可以通信，不过代价较大</li> <li>现在，一般通用的叫法单线程与多线程，都是指在一个进程内的单和多。（所以核心还是得属于一个进程才行）</li></ul> <h2 id="浏览器是多线程的"><a href="#浏览器是多线程的" class="header-anchor">#</a> 浏览器是多线程的</h2> <p>理解了进程与线程了区别后，需要明确：</p> <ol><li>浏览器是多进程的</li> <li>没打开一个 Tab 页，就相当于创建了一个独立的浏览器进程。</li></ol> <p>一起看下，Chrome 打开一个页面需要启动多少进程？</p> <p>和 Windows 任务管理器一样，Chrome 任务管理器也是用来展示运行中 Chrome 使用的进程信息的。从图中可以看到，Chrome 启动了 <strong>4 个进程</strong>：</p> <p><img src="/fe-tutorial/assets/img/javascript-browser-eg2.ce7f8cfe.png" alt="eg2"></p> <h3 id="浏览器都包含哪些进程？"><a href="#浏览器都包含哪些进程？" class="header-anchor">#</a> 浏览器都包含哪些进程？</h3> <p>先看看最新的 Chrome 进程架构：</p> <ul><li>浏览器进程。主要负责界面显示、用户交互、子进程管理，同时提供存储等功能。</li> <li>渲染进程(浏览器内核)。核心任务是将 HTML、CSS 和 JavaScript 转换为用户可以与之交互的网页，也就是页面渲染，脚本执行，事件处理等。排版引擎 Blink 和 JavaScript 引擎 V8 都是运行在该进程中。默认情况下，Chrome 会为每个 Tab 标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下。</li> <li>GPU 进程。其实，Chrome 刚开始发布的时候是没有 GPU 进程的。而 GPU 的使用初衷是为了实现 3D CSS 的效果，只是随后网页、Chrome 的 UI 界面都选择采用 GPU 来绘制，这使得 GPU 成为浏览器普遍的需求。最后，Chrome 在其多进程架构上也引入了 GPU 进程。</li> <li>网络进程。主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程。</li> <li>插件进程。主要是负责插件的运行，因插件易崩溃，所以需要通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响。</li></ul> <p>再看看上面的问题：仅仅打开了 1 个页面，为什么有 4 个进程？因为打开 1 个页面至少需要 1 个网络进程、1 个浏览器进程、1 个 GPU 进程以及 1 个渲染进程，共 4 个；如果打开的页面有运行插件的话，还需要再加上 1 个插件进程。</p> <p>早期浏览器是单进程的，顾名思义，单进程浏览器是指浏览器的所有功能模块都是运行在同一个进程里，这些模块包含了网络、插件、JavaScript 运行环境、渲染引擎和页面等，会存在一下问题：</p> <ul><li>不稳定：插件或者渲染引擎的崩溃将导致整个浏览器的崩溃。</li> <li>不流畅：所有页面的渲染模块、JavaScript 执行环境以及插件都是运行在同一个线程中的，这就意味着同一时刻只能有一个模块可以执行。某个页面不合理的脚本（例如死循环）或者插件会让单进程浏览器变卡顿外，此外页面的内存泄漏也会造成页面的变慢。</li> <li>不安全：恶意的脚本和插件可以通过浏览器的漏洞来获取系统权限，这些脚本获取系统权限之后也可以对你的电脑做一些恶意的事情，同样也会引发安全问题。</li></ul> <p>默认情况下，Chrome 会为每个页面分配一个渲染进程（进程里面有多个子线程），也就是说，每打开一个新页面就会配套创建一个新的渲染进程。但是，也有一些例外，在某些情况下，浏览器会让多个页面直接运行在同一个渲染进程中。</p> <p>那什么情况下多个页面会同时运行在一个渲染进程中呢？</p> <p>要解决这个问题，我们就需要先了解下什么是同一站点（same-site）。具体地讲，我们将“同一站点”定义为<strong>根域名</strong>（例如，geekbang.org）加上<strong>协议</strong>（例如，https:// 或者 http://），还包含了该根域名下的所有子域名和不同的端口，比如下面这三个：</p> <div class="language- extra-class"><pre class="language-text"><code>https://time.geekbang.org
https://www.geekbang.org
https://www.geekbang.org:8080
</code></pre></div><p>Chrome 的默认策略是，每个标签对应一个渲染进程。但如果从一个页面打开了另一个新页面，而新页面和当前页面属于同一站点的话，那么新页面会复用父页面的渲染进程。官方把这个默认策略叫 process-per-site-instance。</p> <h3 id="浏览器多进程的优势"><a href="#浏览器多进程的优势" class="header-anchor">#</a> 浏览器多进程的优势</h3> <p>多进程有效的提升了浏览器的稳定性、流畅性和安全性。</p> <ul><li>避免单个崩溃影响整个浏览器</li> <li>避免第三方插件崩溃影响整个浏览器</li> <li>JavaScript 也是运行在渲染进程中的，所以即使 JavaScript 阻塞了渲染进程，影响到的也只是当前的渲染页面，而并不会影响浏览器和其他页面，因为其他页面的脚本是运行在它们自己的渲染进程中的。</li> <li>把插件进程和渲染进程锁在沙箱里面，这样即使在渲染进程或者插件进程里面执行了恶意程序，恶意程序也无法突破沙箱去获取系统权限。</li></ul> <h3 id="重要的浏览器内核（渲染进程）"><a href="#重要的浏览器内核（渲染进程）" class="header-anchor">#</a> 重要的浏览器内核（渲染进程）</h3> <p>上面提到了这么多的进程，那么对于普通的前端操作来说，最终要的是什么呢？答案是渲染进程。</p> <p>浏览器的渲染进程是多线程的，它都包含了哪些线程（列举一些主要常驻线程）：</p> <ol><li>GUI 渲染线程</li></ol> <ul><li>负责渲染浏览器界面，解析 HTML、CSS、构建 DOM 树和 RenderObject 树，布局和绘制等。</li> <li>当界面需要重绘（Repaint）或由于某种操作引发回流（reflow）时，该线程就会执行</li> <li>注意，GUI 渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时GUI线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行。</li></ul> <ol start="2"><li>JS引擎线程</li></ol> <ul><li>也称为 JS 内核，负责处理 Javascript 脚本程序。（例如 V8 引擎）</li> <li>JS 引擎线程负责解析 Javascript 脚本，运行代码。</li> <li>JS 引擎一直等待着任务队列中任务的到来，然后加以处理，一个 Tab 页（renderer进程）中无论什么时候都只有一个 JS 线程在运行 JS 程序</li> <li>同样注意，GUI渲染线程与JS引擎线程是互斥的，所以如果JS执行的时间过长，这样就会造成页面的渲染不连贯，导致页面渲染加载阻塞。</li></ul> <ol start="3"><li>事件触发线程</li></ol> <ul><li>归属于浏览器而不是 JS 引擎，用来控制事件循环（可以理解，JS 引擎自己都忙不过来，需要浏览器另开线程协助）</li> <li>当 JS 引擎执行代码块如 setTimeout 时（也可来自浏览器内核的其他线程,如鼠标点击、AJAX异步请求等），会将对应任务添加到事件线程中</li> <li>当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理</li> <li>注意，由于JS的单线程关系，所以这些待处理队列中的事件都得排队等待JS引擎处理（当JS引擎空闲时才会去执行）</li></ul> <ol start="4"><li>定时触发器线程</li></ol> <ul><li>传说中的 <code>setInterval</code> 与 <code>setTimeout</code> 所在线程</li> <li>浏览器定时计数器并不是由 JavaScript 引擎计数的,（因为 JavaScript 引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确）</li> <li>因此通过单独线程来计时并触发定时（计时完毕后，添加到事件队列中，等待 JS 引擎空闲后执行）</li> <li>注意，W3C 在 HTML 标准中规定，规定要求 <code>setTimeout</code> 中低于 4ms 的时间间隔算为 4ms。</li></ul> <ol start="5"><li>异步http请求线程</li></ol> <ul><li>在 XMLHttpRequest 在连接后是通过浏览器新开一个线程请求</li> <li>将检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中。再由 JavaScript 引擎执行。</li></ul> <p>通过一张图总结一下：</p> <p><img src="data:image/png;base64,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" alt="eg3"></p> <p>为什么JS引擎是单线程的？</p> <p>这个要回到 Js 历史了，布兰登·艾奇(Brendan Eich)老哥用 10 天创造 js。当时js用来干嘛，简单的浏览器交互，验证，操作一下dom是吧。那把它设计成那么复杂干什么，而且如果多线程的话，操作 dom 会出现麻烦的事情，假设一个线程读取 DOM 节点数据的同时，另一个线程把那个 DOM 节点删了，那就需要加锁了，呵呵。所以 js 一个线程就够了，也就是一步一步顺序运行下来。</p> <h3 id="浏览器进程和渲染进程的合作"><a href="#浏览器进程和渲染进程的合作" class="header-anchor">#</a> 浏览器进程和渲染进程的合作</h3> <p>如果自己打开任务管理器，然后打开一个浏览器，就可以看到：任务管理器中出现了两个进程：一个是主控进程，一个则是打开Tab页的渲染进程），然后在这前提下，看下整个大致的过程：</p> <ol><li><p>浏览器进程收到用户请求，首先需要获取页面内容，随后将该任务通过 RendererHost 接口传递给渲染进程。</p></li> <li><p>渲染进程收到消息，简单解析后，交给渲染线程，然后开始渲染。渲染线程接收请求，加载网页并渲染网页，这其中可能需要浏览器进程获取资源和需要 GPU 进程来帮助渲染；当然可能会有 JS 线程操作 DOM（这样可能会造成回流并重绘），最后渲染进程将结果传递给浏览器进程。</p></li> <li><p>浏览器进程接收到结果并将结果绘制出来</p></li></ol> <p>也就是下面这张图：</p> <p><img src="data:image/png;base64,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" alt="eg4"></p> <h2 id="浏览器内核中线程之间的关系"><a href="#浏览器内核中线程之间的关系" class="header-anchor">#</a> 浏览器内核中线程之间的关系</h2> <h3 id="gui-渲染线程与-js-引擎线程互斥"><a href="#gui-渲染线程与-js-引擎线程互斥" class="header-anchor">#</a> GUI 渲染线程与 JS 引擎线程互斥</h3> <p>由于 JavaScript 是可操纵 DOM 的，如果在修改这些元素属性同时渲染界面（即JS线程和UI线程同时运行），那么渲染线程前后获得的元素数据就可能不一致了。</p> <p>因此为了防止渲染出现不可预期的结果，浏览器设置 GUI 渲染线程与 JS 引擎为互斥的关系，当JS引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。</p> <p>正因为这样，当 JS 执行时间过长的时候，比如大量计算，将会导致页面卡顿。</p> <h3 id="webworker，js的多线程？"><a href="#webworker，js的多线程？" class="header-anchor">#</a> WebWorker，JS的多线程？</h3> <p>那么 JS 怎么处理大量计算的问题？</p> <p>HTML5 中支持了Web Worker。通过使用 Web Workers，Web 应用程序可以在独立于主线程的后台线程中，运行一个脚本操作。这样做的好处是可以在独立线程中执行费时的处理任务，从而允许主线程（通常是UI线程）不会因此被阻塞/放慢。</p> <p>这样理解下：</p> <ol><li><p>创建 Worker 时，JS 引擎向浏览器申请开一个子线程，子线程是浏览器开的，完全受主线程控制，而且不能操作 DOM。</p></li> <li><p>JS 引擎线程与 worker 线程间通过特定的方式通信（postMessage API，需要通过序列化对象来与线程交互特定的数据）。</p></li></ol> <p>所以，如果有非常耗时的工作，请单独开一个 Worker 线程，这样里面不管如何翻天覆地都不会影响 JS 引擎主线程，只待计算出结果后，将结果通信给主线程即可，perfect!</p> <p>而且注意下，JS 引擎是单线程的，这一点的本质仍然未改变，Worker 可以理解是浏览器给 JS 引擎开的外挂，专门用来解决那些大量计算问题。</p> <p>除了 Web Worker 之外， worker 之外，还有一些其他种类的 worker ：</p> <ul><li>Shared Workers：可被不同的窗体的多个脚本运行，例如 IFrames 等，只要这些 workers 处于同一主域。共享 worker 比专用 worker 稍微复杂一点 — 脚本必须通过活动端口进行通讯。详情请见 SharedWorker。</li> <li>Service Workers：一般作为 web 应用程序、浏览器和网络（如果可用）之间的代理服务。他们旨在（除开其他方面）创建有效的离线体验，拦截网络请求，以及根据网络是否可用采取合适的行动，更新驻留在服务器上的资源。他们还将允许访问推送通知和后台同步 API。</li> <li>Chrome Workers：是一种仅适用于 firefox 的 worker。如果您正在开发附加组件，希望在扩展程序中使用 worker 且可以访问 js-ctypes，那么可以使用Chrome Workers。详情请见 ChromeWorker。</li> <li>音频 Workers：可以在网络 worker 上下文中直接完成脚本化音频处理.</li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://juejin.im/post/5a6547d0f265da3e283a1df7#heading-8" target="_blank" rel="noopener noreferrer">从浏览器多进程到JS单线程，JS运行机制最全面的一次梳理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html" target="_blank" rel="noopener noreferrer">进程与线程的一个简单解释<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API" target="_blank" rel="noopener noreferrer">MDN - Web Workers API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/niexias/fe-tutorial/edit/master/javaScript/browser/浏览器的多进程和JS单线程.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/20/2019, 10:25:10 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe-tutorial/javaScript/RegExp/应用.html" class="prev">
        应用
      </a></span> <span class="next"><a href="/fe-tutorial/javaScript/browser/浏览器渲染过程.html">
        浏览器的渲染过程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fe-tutorial/assets/js/app.c67e16a5.js" defer></script><script src="/fe-tutorial/assets/js/2.16b1dcc2.js" defer></script><script src="/fe-tutorial/assets/js/19.8bd17825.js" defer></script>
  </body>
</html>
