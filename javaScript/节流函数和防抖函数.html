<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>节流函数和防抖函数 | fe-tutorial</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/fe-tutorial/favicon.ico">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-163994034-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'UA-163994034-1');
      </script>
    <meta name="description" content="前端学习笔记">
    
    <link rel="preload" href="/fe-tutorial/assets/css/0.styles.83dc6278.css" as="style"><link rel="preload" href="/fe-tutorial/assets/js/app.fcbe7dac.js" as="script"><link rel="preload" href="/fe-tutorial/assets/js/2.d6443948.js" as="script"><link rel="preload" href="/fe-tutorial/assets/js/93.e1e7414d.js" as="script"><link rel="prefetch" href="/fe-tutorial/assets/js/10.525a81ed.js"><link rel="prefetch" href="/fe-tutorial/assets/js/100.612ef9bb.js"><link rel="prefetch" href="/fe-tutorial/assets/js/101.7cd8c760.js"><link rel="prefetch" href="/fe-tutorial/assets/js/11.824f57a6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/12.4085965f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/13.401309e1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/14.61f0ea27.js"><link rel="prefetch" href="/fe-tutorial/assets/js/15.1fae2281.js"><link rel="prefetch" href="/fe-tutorial/assets/js/16.87829ae5.js"><link rel="prefetch" href="/fe-tutorial/assets/js/17.e70508a1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/18.22391f5d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/19.ffe1bccb.js"><link rel="prefetch" href="/fe-tutorial/assets/js/20.456acb11.js"><link rel="prefetch" href="/fe-tutorial/assets/js/21.2528cd2d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/22.9ccec86b.js"><link rel="prefetch" href="/fe-tutorial/assets/js/23.03d411bc.js"><link rel="prefetch" href="/fe-tutorial/assets/js/24.ad82ced8.js"><link rel="prefetch" href="/fe-tutorial/assets/js/25.586e7716.js"><link rel="prefetch" href="/fe-tutorial/assets/js/26.9e1c1213.js"><link rel="prefetch" href="/fe-tutorial/assets/js/27.e115a271.js"><link rel="prefetch" href="/fe-tutorial/assets/js/28.f59675cc.js"><link rel="prefetch" href="/fe-tutorial/assets/js/29.a34447d9.js"><link rel="prefetch" href="/fe-tutorial/assets/js/3.5753f381.js"><link rel="prefetch" href="/fe-tutorial/assets/js/30.07e7fcdc.js"><link rel="prefetch" href="/fe-tutorial/assets/js/31.6a5c3f52.js"><link rel="prefetch" href="/fe-tutorial/assets/js/32.a1a21b0c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/33.e4d3920d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/34.e7ef5f1f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/35.c8a82d02.js"><link rel="prefetch" href="/fe-tutorial/assets/js/36.7fe42190.js"><link rel="prefetch" href="/fe-tutorial/assets/js/37.b4b6e647.js"><link rel="prefetch" href="/fe-tutorial/assets/js/38.92039ee3.js"><link rel="prefetch" href="/fe-tutorial/assets/js/39.dca3639c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/4.e863a7ec.js"><link rel="prefetch" href="/fe-tutorial/assets/js/40.d1db7a64.js"><link rel="prefetch" href="/fe-tutorial/assets/js/41.49ee1545.js"><link rel="prefetch" href="/fe-tutorial/assets/js/42.c1863126.js"><link rel="prefetch" href="/fe-tutorial/assets/js/43.822f1bc1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/44.bfa731dd.js"><link rel="prefetch" href="/fe-tutorial/assets/js/45.4f35d4b7.js"><link rel="prefetch" href="/fe-tutorial/assets/js/46.cf4f0367.js"><link rel="prefetch" href="/fe-tutorial/assets/js/47.20ad918b.js"><link rel="prefetch" href="/fe-tutorial/assets/js/48.90c6a427.js"><link rel="prefetch" href="/fe-tutorial/assets/js/49.5c079724.js"><link rel="prefetch" href="/fe-tutorial/assets/js/5.eed07e52.js"><link rel="prefetch" href="/fe-tutorial/assets/js/50.4449ae3e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/51.d6e2154b.js"><link rel="prefetch" href="/fe-tutorial/assets/js/52.52d81b04.js"><link rel="prefetch" href="/fe-tutorial/assets/js/53.d3c20efa.js"><link rel="prefetch" href="/fe-tutorial/assets/js/54.3148806d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/55.b6939cf6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/56.534e810a.js"><link rel="prefetch" href="/fe-tutorial/assets/js/57.1755837a.js"><link rel="prefetch" href="/fe-tutorial/assets/js/58.17b55089.js"><link rel="prefetch" href="/fe-tutorial/assets/js/59.65639cc6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/6.65f0817d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/60.8a5327f6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/61.c279e162.js"><link rel="prefetch" href="/fe-tutorial/assets/js/62.d54550b7.js"><link rel="prefetch" href="/fe-tutorial/assets/js/63.33a0fc33.js"><link rel="prefetch" href="/fe-tutorial/assets/js/64.131873b5.js"><link rel="prefetch" href="/fe-tutorial/assets/js/65.d6b495ca.js"><link rel="prefetch" href="/fe-tutorial/assets/js/66.f1236341.js"><link rel="prefetch" href="/fe-tutorial/assets/js/67.ba9a5e98.js"><link rel="prefetch" href="/fe-tutorial/assets/js/68.da228f4e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/69.1ec74af0.js"><link rel="prefetch" href="/fe-tutorial/assets/js/7.4742fe99.js"><link rel="prefetch" href="/fe-tutorial/assets/js/70.c47676e5.js"><link rel="prefetch" href="/fe-tutorial/assets/js/71.edcc3be0.js"><link rel="prefetch" href="/fe-tutorial/assets/js/72.2ae75d2e.js"><link rel="prefetch" href="/fe-tutorial/assets/js/73.1bbdc79c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/74.1b282d27.js"><link rel="prefetch" href="/fe-tutorial/assets/js/75.caf4594f.js"><link rel="prefetch" href="/fe-tutorial/assets/js/76.75346e61.js"><link rel="prefetch" href="/fe-tutorial/assets/js/77.e38d5475.js"><link rel="prefetch" href="/fe-tutorial/assets/js/78.19c51d2c.js"><link rel="prefetch" href="/fe-tutorial/assets/js/79.482c65a8.js"><link rel="prefetch" href="/fe-tutorial/assets/js/8.a6d8756d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/80.5a23eb1b.js"><link rel="prefetch" href="/fe-tutorial/assets/js/81.d8b30993.js"><link rel="prefetch" href="/fe-tutorial/assets/js/82.7f8dd207.js"><link rel="prefetch" href="/fe-tutorial/assets/js/83.a1d90596.js"><link rel="prefetch" href="/fe-tutorial/assets/js/84.d50cc4d6.js"><link rel="prefetch" href="/fe-tutorial/assets/js/85.7e830904.js"><link rel="prefetch" href="/fe-tutorial/assets/js/86.b76a388a.js"><link rel="prefetch" href="/fe-tutorial/assets/js/87.a51828b0.js"><link rel="prefetch" href="/fe-tutorial/assets/js/88.b27fbdb1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/89.e1518065.js"><link rel="prefetch" href="/fe-tutorial/assets/js/9.8eb689ae.js"><link rel="prefetch" href="/fe-tutorial/assets/js/90.a08e9e28.js"><link rel="prefetch" href="/fe-tutorial/assets/js/91.aa9ddc8d.js"><link rel="prefetch" href="/fe-tutorial/assets/js/92.c4202f45.js"><link rel="prefetch" href="/fe-tutorial/assets/js/94.1d202abd.js"><link rel="prefetch" href="/fe-tutorial/assets/js/95.eb770ef7.js"><link rel="prefetch" href="/fe-tutorial/assets/js/96.9f353998.js"><link rel="prefetch" href="/fe-tutorial/assets/js/97.2fff3dd8.js"><link rel="prefetch" href="/fe-tutorial/assets/js/98.2a39b6d1.js"><link rel="prefetch" href="/fe-tutorial/assets/js/99.58876920.js">
    <link rel="stylesheet" href="/fe-tutorial/assets/css/0.styles.83dc6278.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe-tutorial/" class="home-link router-link-active"><!----> <span class="site-name">fe-tutorial</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe-tutorial/javaScript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/fe-tutorial/algo/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/fe-tutorial/network/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/fe-tutorial/fee/" class="nav-link">
  工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-tutorial/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://niexia.github.io/learn-source-code/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  源码学习
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://niexia.github.io/reading-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  读书笔记
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/niexia/fe-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe-tutorial/javaScript/" class="nav-link router-link-active">
  JavaScript
</a></div><div class="nav-item"><a href="/fe-tutorial/algo/" class="nav-link">
  数据结构和算法
</a></div><div class="nav-item"><a href="/fe-tutorial/network/" class="nav-link">
  网络
</a></div><div class="nav-item"><a href="/fe-tutorial/fee/" class="nav-link">
  工程化
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="了解更多" class="mobile-dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fe-tutorial/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="https://niexia.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  个人博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://niexia.github.io/learn-source-code/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  源码学习
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://niexia.github.io/reading-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  读书笔记
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/niexia/fe-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/fe-tutorial/javaScript/执行环境和执行栈.html" class="sidebar-link">执行环境和执行栈</a></li><li><a href="/fe-tutorial/javaScript/作用域和闭包.html" class="sidebar-link">作用域和闭包</a></li><li><a href="/fe-tutorial/javaScript/this.html" class="sidebar-link">this</a></li><li><a href="/fe-tutorial/javaScript/对象、原型和原型链.html" class="sidebar-link">对象、原型和原型链</a></li><li><a href="/fe-tutorial/javaScript/实现继承.html" class="sidebar-link">实现继承</a></li><li><a href="/fe-tutorial/javaScript/实现new.html" class="sidebar-link">实现 new</a></li><li><a href="/fe-tutorial/javaScript/实现call,apply和bind.html" class="sidebar-link">call、apply 和 bind</a></li><li><a href="/fe-tutorial/javaScript/实现instanceof.html" class="sidebar-link">实现 instanceof</a></li><li><a href="/fe-tutorial/javaScript/深拷贝和浅拷贝.html" class="sidebar-link">深拷贝和浅拷贝</a></li><li><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html" class="active sidebar-link">节流函数和防抖函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#节流函数-throttle" class="sidebar-link">节流函数 throttle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#定时器和时间戳结合" class="sidebar-link">定时器和时间戳结合</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#underscore-中-throttle-的实现" class="sidebar-link">underscore 中 throttle 的实现</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#throttle-应用场景" class="sidebar-link">throttle 应用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#防抖-debounce" class="sidebar-link">防抖 debounce</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#underscode-中-debounce-的实现" class="sidebar-link">underscode 中 debounce 的实现</a></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#debounce-应用场景" class="sidebar-link">debounce 应用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/fe-tutorial/javaScript/节流函数和防抖函数.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/fe-tutorial/javaScript/高阶函数.html" class="sidebar-link">高阶函数</a></li><li><a href="/fe-tutorial/javaScript/函数柯里化.html" class="sidebar-link">函数柯里化</a></li><li><a href="/fe-tutorial/javaScript/EventEmitter.html" class="sidebar-link">EventEmitter</a></li><li><a href="/fe-tutorial/javaScript/实现Promise.html" class="sidebar-link">实现 Promise</a></li><li><a href="/fe-tutorial/javaScript/实现异步打印.html" class="sidebar-link">实现异步打印</a></li><li><a href="/fe-tutorial/javaScript/数组去重,扁平化和最值.html" class="sidebar-link">数组去重，扁平化和最值</a></li><li><a href="/fe-tutorial/javaScript/数组乱序.html" class="sidebar-link">数组乱序</a></li><li><a href="/fe-tutorial/javaScript/懒加载.html" class="sidebar-link">懒加载</a></li><li><a href="/fe-tutorial/javaScript/无限滚动.html" class="sidebar-link">无限滚动</a></li><li><a href="/fe-tutorial/javaScript/虚拟滚动.html" class="sidebar-link">/javaScript/虚拟滚动.html</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>RegExp</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/RegExp/正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/fe-tutorial/javaScript/RegExp/RegExp的属性和方法.html" class="sidebar-link">RegExp 的属性和方法</a></li><li><a href="/fe-tutorial/javaScript/RegExp/应用.html" class="sidebar-link">应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器工作原理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/browser/浏览器的多进程和JS单线程.html" class="sidebar-link">浏览器的多进程和JS单线程</a></li><li><a href="/fe-tutorial/javaScript/browser/浏览器渲染过程.html" class="sidebar-link">浏览器的渲染过程</a></li><li><a href="/fe-tutorial/javaScript/browser/EventLoop.html" class="sidebar-link">Event Loop</a></li><li><a href="/fe-tutorial/javaScript/browser/栈空间和堆空间.html" class="sidebar-link">栈空间和堆空间</a></li><li><a href="/fe-tutorial/javaScript/browser/垃圾回收.html" class="sidebar-link">垃圾回收</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fe-tutorial/javaScript/effective/性能优化.html" class="sidebar-link">性能优化</a></li><li><a href="/fe-tutorial/javaScript/effective/DNS缓存和预解析.html" class="sidebar-link">DNS 缓存和预解析</a></li><li><a href="/fe-tutorial/javaScript/effective/减少请求次数和体积.html" class="sidebar-link">减少请求次数和体积</a></li><li><a href="/fe-tutorial/javaScript/effective/利用缓存.html" class="sidebar-link">利用缓存</a></li><li><a href="/fe-tutorial/javaScript/effective/CDN.html" class="sidebar-link">CDN</a></li><li><a href="/fe-tutorial/javaScript/effective/浏览器渲染机制和优化.html" class="sidebar-link">浏览器渲染机制和优化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="节流函数和防抖函数"><a href="#节流函数和防抖函数" class="header-anchor">#</a> 节流函数和防抖函数</h1> <p>在一些场景下会遇到频率很高的事件或者连续的事件，例如 <code>scroll</code>、<code>mousemove</code>、<code>onresize</code> 等，如果不进行性能的优化，就有可能造成页面的卡顿现象。<strong>我们需要做的是降低触发回调的频率</strong>，解决这类问题，常用的就是节流函数和防抖函数。</p> <h2 id="节流函数-throttle"><a href="#节流函数-throttle" class="header-anchor">#</a> 节流函数 throttle</h2> <p>简单的说，函数节流能使得连续的函数执行，变为<strong>固定时间段间断地执行</strong>。</p> <p>以 <code>scroll</code> 事件为例：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onscroll</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>轻轻滚动下窗口，控制台打印了多个 hello world 字符串。如果 <code>scroll</code> 回调不是简单的打印字符串，而是涉及一些 DOM 操作，这样频繁的调用，低版本浏览器可能就会直接假死。为了解决这个问题，希望可以间隔时间段触发回调的执行，比如上面的例子每 1000ms 打印一次，如何实现之？</p> <p>实现的方式有两种：</p> <ol><li>使用时间戳，记录上次执行的时间戳，然后每次触发 <code>scroll</code> 事件执行回调，回调中判断当前时间戳距离上次执行时间戳的间隔是否已经到达 1000ms，如果是，则执行，并更新上次执行的时间戳，如此循环：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 上一次执行 fn 的时间</span>
  <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> last <span class="token operator">&gt;</span> interval<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      last <span class="token operator">=</span> now<span class="token punctuation">;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>使用定时器，比如当 <code>scroll</code> 事件刚触发时，设置个 1000ms 的定时器，此后每次触发 <code>scroll</code> 事件触发回调，如果已经存在定时器，则回调不执行方法，直到定时器触发，<code>timer</code> 被清除，然后重新设置定时器。</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>是一般的使用场景，这两种方式都可以满足了，只是还存在一点问题：</p> <ul><li>第一种的缺陷是：当事件停止触发时，不会执行最后一次回调。相当于每次都在间隔的开头执行。</li> <li>第二种的缺陷是：第一次执行会延迟，事件触发结束之后还存在定时器，所以会执行最后一次方法。相当于每次都在间隔的结尾执行。</li></ul> <h3 id="定时器和时间戳结合"><a href="#定时器和时间戳结合" class="header-anchor">#</a> 定时器和时间戳结合</h3> <p>这里将定时器和时间戳结合起来：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> last <span class="token operator">&gt;=</span> interval<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果时间间隔大于等于设定的时间间隔阈值，则执行</span>
      last <span class="token operator">=</span> now<span class="token punctuation">;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token comment">// 如果时间间隔小于设定的时间间隔阈值，生成定时器，执行最后一次调用</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        last <span class="token operator">=</span> now<span class="token punctuation">;</span>
        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>虽然上面保证最后一次可以执行，每次定时都是 <code>interval</code> 会存在一个问题，已经忽略掉了 now - last 这段等待的时间，所以就可能导致最后一次执行比定义的时间间隔稍长。更加完善的方式应该是：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> delay <span class="token operator">=</span> interval <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> last<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      last <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        last <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="underscore-中-throttle-的实现"><a href="#underscore-中-throttle-的实现" class="header-anchor">#</a> underscore 中 throttle 的实现</h3> <p>underscore 考虑了高级配置，即可以选择是否需要响应事件刚开始的那次回调（配置 <code>leading</code> 参数），以及事件结束后的那次回调（配置 <code>trailing</code> 参数）。需要特别注意的是，两者不能同时配置！</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Returns a function, that, when invoked, will only be triggered at most once</span>
<span class="token comment">// during a given window of time. Normally, the throttled function will run</span>
<span class="token comment">// as much as it can, without ever going more than once per `wait` duration;</span>
<span class="token comment">// but if you'd like to disable the execution on the leading edge, pass</span>
<span class="token comment">// `{leading: false}`. To disable execution on the trailing edge, ditto.</span>
_<span class="token punctuation">.</span><span class="token function-variable function">throttle</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> timeout<span class="token punctuation">,</span> context<span class="token punctuation">,</span> args<span class="token punctuation">,</span> result<span class="token punctuation">;</span>
  <span class="token keyword">var</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>options<span class="token punctuation">)</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">later</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果 options.leading === false，则每次触发回调后将 previous</span>
    <span class="token comment">// 置为 0，否则置为当前时间戳</span>
    previous <span class="token operator">=</span> options<span class="token punctuation">.</span>leading <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> context <span class="token operator">=</span> args <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">throttled</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 记录当前时间</span>
    <span class="token keyword">var</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 第一次执行回调并且设置第一个回调不是立即执行，则将 previous</span>
    <span class="token comment">// 设置为当前时间戳，相当于表示刚刚执行过，这次不用执行</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>previous <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>leading <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> previous <span class="token operator">=</span> now<span class="token punctuation">;</span>

    <span class="token comment">// 距离下次执行需要等待的时间</span>
    <span class="token keyword">var</span> remaining <span class="token operator">=</span> wait <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span><span class="token punctuation">;</span>

    context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    args <span class="token operator">=</span> arguments<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>remaining <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> remaining <span class="token operator">&gt;</span> wait<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果时间间隔到了（remaining &lt;= 0 即 now - previous &gt; wait）</span>
      <span class="token comment">// 或者 remaining &gt; wait 表示客户端系统时间被调整过，</span>
      <span class="token comment">// 则触发执行方法</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
      result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout<span class="token punctuation">)</span> context <span class="token operator">=</span> args <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timeout <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>trailing <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果已经存在定时器或者最后一次不需要触发则不会进入这个分支</span>
      <span class="token comment">// 否则 setTimeout 定时 remaining 之后执行 later</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> remaining<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  throttled<span class="token punctuation">.</span><span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    timeout <span class="token operator">=</span> context <span class="token operator">=</span> args <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> throttled<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="throttle-应用场景"><a href="#throttle-应用场景" class="header-anchor">#</a> throttle 应用场景</h3> <p>函数节流有哪些应用场景？哪些时候我们需要间隔一定时间触发回调来控制函数调用频率？</p> <ul><li>DOM 元素的拖拽功能实现（mousemove）</li> <li>射击游戏的 mousedown/keydown 事件（单位时间只能发射一颗子弹）</li> <li>计算鼠标移动的距离（mousemove）</li> <li>Canvas 模拟画板功能（mousemove）</li> <li>搜索联想（keyup）</li> <li>监听滚动事件判断是否到页面底部自动加载更多：给 scroll 加了 debounce 后，只有用户停止滚动后，才会判断是否到了页面底部；如果是 throttle 的话，只要页面滚动就会间隔一段时间判断一次。</li></ul> <h2 id="防抖-debounce"><a href="#防抖-debounce" class="header-anchor">#</a> 防抖 debounce</h2> <p>函数去抖就是对于一定时间段的连续的函数调用，只让其执行一次。</p> <p>实现原理就是利用定时器，函数第一次执行时设定一个定时器，之后调用时发现已经设定过定时器就清空之前的定时器，并重新设定一个新的定时器，如果存在没有被清空的定时器，当定时器计时结束后触发函数执行。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样就可以实现一个 <code>debounce</code> 了，但是如果想第一触发的时候就执行 <code>fn</code> 那就不行了，这里再改写一下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay<span class="token punctuation">,</span> immediate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>immediate <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 不影响下次立即触发</span>
      <span class="token comment">// timer = null;</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里加上了一个判断处理，如果 <code>immediate</code> 为 <code>true</code>，并且是第一次执行防抖函数，则调用 <code>fn.apply(this, args);</code>。</p> <h3 id="underscode-中-debounce-的实现"><a href="#underscode-中-debounce-的实现" class="header-anchor">#</a> underscode 中 debounce 的实现</h3> <p>以下是源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Returns a function, that, as long as it continues to be invoked, will not</span>
<span class="token comment">// be triggered. The function will be called after it stops being called for</span>
<span class="token comment">// N milliseconds. If `immediate` is passed, trigger the function on the</span>
<span class="token comment">// leading edge, instead of the trailing.</span>
_<span class="token punctuation">.</span><span class="token function-variable function">debounce</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> immediate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> timeout<span class="token punctuation">,</span> result<span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">later</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> debounced <span class="token operator">=</span> <span class="token function">restArguments</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> callNow <span class="token operator">=</span> <span class="token operator">!</span>timeout<span class="token punctuation">;</span>
      timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>callNow<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      timeout <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span>later<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  debounced<span class="token punctuation">.</span><span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> debounced<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 根据给定的毫秒 wait 延迟执行函数 func</span>
_<span class="token punctuation">.</span>delay <span class="token operator">=</span> <span class="token function">restArguments</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> wait<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">restArguments</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">func<span class="token punctuation">,</span> startIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 不输入 startIndex 则自动取最后一个</span>
  startIndex <span class="token operator">=</span> startIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> func<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">+</span>startIndex<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只获取从 startIndex 开始的参数组成 rest</span>
    <span class="token keyword">var</span> length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> startIndex<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        rest <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span>
        index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      rest<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>index <span class="token operator">+</span> startIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>startIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> rest<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rest<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>startIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取 startIndex 之前的参数</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> startIndex<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      args<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 把 rest 放到 args[startIndex]</span>
    args<span class="token punctuation">[</span>startIndex<span class="token punctuation">]</span> <span class="token operator">=</span> rest<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
_<span class="token punctuation">.</span>restArguments <span class="token operator">=</span> restArguments<span class="token punctuation">;</span>
</code></pre></div><p>这里的 <code>debounce</code> 还增加了几个功能：</p> <ul><li>定时器计时结束后清除 timeout，使之不影响下次连续事件的触发</li> <li>新增了手动取消功能 cancel</li></ul> <h3 id="debounce-应用场景"><a href="#debounce-应用场景" class="header-anchor">#</a> debounce 应用场景</h3> <p>函数去抖有哪些应用场景？哪些时候对于连续的事件响应我们只需要执行一次回调？</p> <ul><li>每次 resize/scroll 触发统计事件</li> <li>文本输入的验证（连续输入文字后发送 AJAX 请求进行验证，验证一次就好）</li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://github.com/lessfish/underscore-analysis/issues/20" target="_blank" rel="noopener noreferrer">JavaScript 函数节流和函数去抖应用场景辨析<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/lessfish/underscore-analysis/issues/22" target="_blank" rel="noopener noreferrer">underscore 函数节流的实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/YvetteLau/Step-By-Step/issues/12" target="_blank" rel="noopener noreferrer">节流(throttle)函数的作用是什么？有哪些应用场景，请实现一个节流函数。<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.im/post/5caf39d8f265da03826106b8" target="_blank" rel="noopener noreferrer">防抖(Debounce) &amp; 节流(Throttle)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/niexia/fe-tutorial/edit/master/docs/javaScript/节流函数和防抖函数.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/16/2022, 12:59:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe-tutorial/javaScript/深拷贝和浅拷贝.html" class="prev">
        深拷贝和浅拷贝
      </a></span> <span class="next"><a href="/fe-tutorial/javaScript/高阶函数.html">
        高阶函数
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fe-tutorial/assets/js/app.fcbe7dac.js" defer></script><script src="/fe-tutorial/assets/js/2.d6443948.js" defer></script><script src="/fe-tutorial/assets/js/93.e1e7414d.js" defer></script>
  </body>
</html>
